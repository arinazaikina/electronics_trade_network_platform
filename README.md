# Онлайн платформа торговой сети электроники

## Запуск проекта

На машине, где разворачивается проект, должны быть установлены docker и docker-compose.
Для их установки обратитесь к официальной документации.

1. Открыть терминал
2. С помощью команды `cd` перейти в каталог, где будет размещен проект
3. Выполнить команду для клонирования проекта

```bash
git clone https://github.com/arinazaikina/electronics_trade_network_platform.git
```

4. Перейти в каталог проекта

```bash
cd electronics_trade_network_platform
```

5. В корневой папке проекта создать файл `.env`

```bash
touch .env
```

6. Открыть файл

```bash
nano .env
```

7. Записать в файл следующие настройки (можно указать свои значения)

Не менять значения `POSTGRES_HOST=db_shop`.
Для локального запуска `HOST` также можно не менять.

```
POSTGRES_USER=user
POSTGRES_DB=shop_db
POSTGRES_PORT=5432
POSTGRES_PASSWORD=12345
POSTGRES_HOST=db_shop

HOST=127.0.0.1
```

В каталоге проекта есть шаблон `.env.template`

8. Запустить проект с помощью Docker, используя следующую команду:

```bash
docker-compose build --no-cache && docker-compose up -d
```

9. Выполнить миграции и загрузить тестовые данные

```bash
docker exec -it api_shop bash -c "python manage.py migrate && python manage.py loaddata data.json && exit"
```

## Тестирование сервиса

* Написано 92 unit-теста
* Код покрыт тестами на 98 %

Для запуска тестов:

```bash
docker exec -it api_shop /bin/bash -c "coverage run --source='.' manage.py test && coverage report && exit"
```

## Доступ к сервису

Показаны ссылки для случая запуска на локальной машине.

* Swagger: http://127.0.0.1/swagger/
* Административная панель: http://127.0.0.1/admin/

## Описание проекта

После загрузки тестовых данных, что было сделано на шаге 9, будут доступны 2 пользователя.

* Супер пользователь: admin@mail.com, пароль qwerty123!.
* Пользователь max@mail.com, пароль qwerty123!

Проект представляет собой backend-часть для онлайн платформы торговой сети электроники и административную панель.

Реализован следующий функционал:

* авторизация и аутентификация пользователей;
* административная панель;
* CRUD для модели звена цепочки поставщиков;
* CRUD для модели продукта;
* фильтр поставщиков по названию города на административной панели;
* фильтр поставщиков по стране в API.

### Бизнес-логика

* Поставщик - это предыдущий по иерархии объект сети.
* Есть 3 типа поставщика: завод, розничная сеть, индивидуальный предприниматель.
* В качестве родительского звена может выступать любой тип поставщика.
* Каждое звено сети ссылается только на одного поставщика (не обязательно предыдущего по иерархии).
* Уровень иерархии определяется не названием звена, а отношением к остальным элементам сети.
* Завод не может иметь родителя, то есть завод всегда выступает в качестве родительского звена.
* Родительское звено не может иметь долг перед поставщиком, так как у родительского звена нет поставщика.
* Звено может быть без проблем удалено, если у него нет долга и нет дочерних звеньев.
* Если звено имеет долг перед поставщиком, то его нельзя удалить.
* Если звено имеет дочерние звенья на следующем уровне иерархии, у которых есть долг перед этим звеном, то
  это звено не может быть удалено.
* Если один из поставщиков удаляется или меняется его место в иерархии, дети этого поставщика автоматически
  "переподключаются" к родительскому звену удаляемого или меняющегося поставщика.
* Нельзя обновить долг перед поставщиком через API. Это можно сделать только через административную панель.

### Права доступа

После регистрации пользователь автоматически создается с флагом is_staff = True.

**Анонимный пользователь**:

- имеет доступ только к конечной точке регистрации `/users/register/`;
- к остальным конечным точкам API доступа не имеет;
- не имеет доступа к административной панели.

**Аутентифицированный пользователь (активный пользователь):**

- имеет доступ ко всем конечным точкам API;
- имеет доступ к звеньям цепочки поставщиков на административной панели;
- имеет доступ к продуктам на административной панели;
- не имеет доступ к пользователям на административной панели.

**Суперпользователь:**

- имеет доступ ко всем конечным точкам API;
- имеет доступ к звеньям цепочки поставщиков на административной панели;
- имеет доступ к продуктам на административной панели;
- имеет доступ к пользователям на административной панели.

Через административную панель суперпользователь может изменить права доступа для других пользователей:

- сделать пользователя неактивным, тогда этому пользователю будет недоступна авторизация, и, следовательно,
  доступ к API и административной панели;
- отменить статус персонала у пользователя, тогда этому пользователю будет недоступна административная панель.

### Регистрация и авторизация

Пользователи могут зарегистрироваться в системе, а далее авторизоваться.

Авторизация в API происходит с помощью механизма токенов.
Чтобы получить токен, необходимо передать свои учетные данные (электронную почту и пароль)
на конечную точку `/users/token/`. В ответе будет отправлен токен доступа.

Для доступа к защищенным конечным точкам API, этот токен должен быть включен в заголовки
всех последующих HTTP-запросов.
Необходимо добавить его в заголовок Authorization следующим образом:
`Authorization: Bearer ваш_токен`, где `ваш_токен` - это токен, который был получен при входе в систему.

### Документация

Для того чтобы упростить процесс интеграции и использования предоставляемого API,
была реализована автоматическая документация с использованием библиотеки `drf-yasg`.

### Административная панель

Действия, которые можно выполнить через административную панель:

* просмотр и управление иерархической структурой (Заводы, Розничные сети, Индивидуальные предприниматели);
* добавление, редактирование и удаление данных о каждом звене;
* управление контактной информацией и деталями продукции;
* просмотр и редактирование задолженности перед поставщиками;
* переход по ссылке на информацию о «Поставщике»;
* фильтрация объектов сети по названию города;
* массовые действия, такие как обнуление задолженности у выбранных объектов, удаление объектов;
* просмотр количества посредников: если звено является первым в цепочке,
  будет указано значение "Первое звено в цепочке". Если звено имеет только одного поставщика,
  то будет указано значение 0.

## Используемые технологии

В разработке проекта использовались следующие технологии:

* Python: основной язык программирования проекта.
* Django Rest Framework (DRF): основной фреймворк для разработки API.
* django-mptt: работа с иерархическими (древовидными) структурами данных.
* djangorestframework-simplejwt: аутентификация и авторизация пользователей через JWT (JSON Web Tokens).
* django-filter: создание фильтров.
* PostgreSQL: система управления базами данных, которая используется для хранения и обработки данных.
* drf-yasg: автоматическая генерация документации к API.
* Docker: контейнеризация приложения.
* gunicorn: развертывание веб-сервиса.
* nginx: раздача статических файлов, перенаправление динамических запросов на gunicorn.
* flake8: статический анализ кода.
* coverage: определение покрытия кода тестами.

### Использование django-mptt

При разработке данного приложения возникла необходимость организовать и управлять иерархической структурой данных,
свойственной нашей модели поставщиков.
Вместо создания такой системы с нуля, было решено использовать проверенное временем решение - библиотеку django-mptt.

Основные причины выбора django-mptt:

* зрелость и надежность: эта библиотека давно используется разработчиками и обладает хорошей репутацией;
* интеграция с Django: django-mptt идеально интегрируется с Django,
  добавляя понятные и удобные методы для работы с деревьями прямо в модели;
* экономия времени: использование готовой библиотеки позволило сосредоточиться на реализации бизнес-логики приложения,
  минимизировав время и ресурсы на реализацию работы с древовидными структурами с нуля.

Таким образом, выбор в пользу django-mptt был обоснован необходимостью эффективного,
надежного и быстрого решения для работы с иерархическими данными в Django.
